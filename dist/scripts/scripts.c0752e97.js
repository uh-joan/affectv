!function(){"use strict";angular.module("finalApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngLodash","mm.foundation","ngMaterial","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("aside",{url:"aside",controller:"AsideCtrl as vm",templateUrl:"views/aside.html","abstract":!0}).state("main",{url:"/main",controller:"MainCtrl as vm",templateUrl:"views/main.html"}).state("pixels",{url:"/pixels/:id",templateUrl:"views/pixels.html",controller:"PixelsCtrl as vm",resolve:{fires:["Pixel","$stateParams","$q",function(a,b,c){var d=c.defer();return a.getFires(b.id).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise}],pixel:["Pixel","$stateParams","$q",function(a,b,c){var d=c.defer();return a.get(b.id).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise}]}}),b.otherwise("/main")}])}(),function(){"use strict";angular.module("finalApp").controller("MainCtrl",["$scope","Advertiser","Pixel","lodash","$state",function(a,b,c,d,e){var f=this;b.getAll().then(function(a){f.advertisers=a.data}),f.equals=function(a,b){return function(c){return c[a]===b}};var g=function(a,b){var c=!0,d={item:null,index:null};return angular.forEach(a,function(e){c&&angular.equals(b.name,e.name)&&(c=!1,d.item=e,d.index=a.indexOf(e))}),d};f.getAdvertiser=function(){var a=g(f.advertisers,f.newAdvertiser);a.item?(f.newAdvertiser.city=f.advertisers[a.index].city,f.newAdvertiser.address=f.advertisers[a.index].address,f.newAdvertiser.post_code=f.advertisers[a.index].post_code,f.newAdvertiser.tel=f.advertisers[a.index].tel):(f.newAdvertiser.city="",f.newAdvertiser.address="",f.newAdvertiser.post_code="",f.newAdvertiser.tel="")},f.editAdvertiser=function(a){var b=g(f.advertisers,a);b.item&&(f.newAdvertiser=b.item,f.showAdvertiserInput=!0)},f.cancelEdit=function(){console.log("on cancel"),f.showAdvertiserInput=!1,f.newAdvertiser=null},f.addAdvertiser=function(){if(f.newAdvertiser){var a=g(f.advertisers,f.newAdvertiser);console.log("in add adv"),a.item?a.item.name?(f.newAdvertiser.id=a.item.id,b.update(f.newAdvertiser).then(function(b){console.log(JSON.stringify(b)),f.advertisers[a.index]=b}),f.newAdvertiser={},f.showAdvertiserInput=!f.showAdvertiserInput):(console.log("deleting..."),f.removeAdvertiser(a.item),f.newAdvertiser={},f.showAdvertiserInput=!f.showAdvertiserInput):f.newAdvertiser.name?(console.log("not in adv, new one"),b.create(f.newAdvertiser).then(function(a){f.advertisers.push(a)}),f.newAdvertiser={},f.showAdvertiserInput=!f.showAdvertiserInput):console.log("ignore adv with empty name")}},f.removeAdvertiser=function(a){var c=g(f.advertisers,a);c.item&&b.remove(a).then(function(){console.log("remove success"),f.advertisers.splice(c.index,1)},function(){console.log("error deleting adv")})},f.toggleAdvertiserInput=function(){f.showAdvertiserInput||(f.showAdvertiserInput=!0)},f.countBadge=function(a){var b=d.reduce(a,function(a,b,c){return a[c]=b.advertiser_id,a},{}),c=[];return d.forEach(b,function(a,b){this[b]=a},c),d.countBy(c,function(a){return a})},c.getAll().then(function(a){f.pixels=a.data,f.badges=f.countBadge(a.data)}),f.editedPixel=null,f.showDeletePixel=!1,f.newPixel={},f.showPixelInput=!1,f.createPixel=function(a,b){console.log("creating pixel: "+b+" for "+a.name),c.create({name:b,advertiser_id:a.id}).then(function(a){f.pixels.push(a),f.badges=f.countBadge(f.pixels)},function(a){console.log(a)})},f.doneEditing=function(a,b){f.editedPixel=null,a.name=b.trim(),b?c.update(a).then(function(b){f.pixels[f.pixels.indexOf(a)]=b},function(a){console.log(a)}):f.deletePixel(a)},f.revertEditing=function(a){f.pixels[f.pixels.indexOf(a)]=f.originalPixel},f.editPixel=function(a){f.editedPixel=a,f.originalPixel=angular.extend({},a)},f.deletePixel=function(a){var b=g(f.pixels,a);c.remove(a).then(function(){console.log("remove px success"),f.pixels.splice(b.index,1),f.badges=f.countBadge(f.pixels)},function(){console.log("error removing pixel")})},f.getFires=function(a){c.getFires(a).then(function(a){f.fires=a},function(){console.log("error getting fires")})},f.cleanFires=function(){f.fires=null},f.gotoPixels=function(a){e.go("pixels",{id:a})}}])}(),function(){"use strict";angular.module("finalApp").service("Pixel",["API_URI","$resource","$q",function(a,b,c){var d=b(a+"/pixels/:id",{id:"@id"},{update:{method:"PUT"},query:{method:"GET"},create:{url:a+"/pixels/new",method:"POST"},remove:{method:"DELETE"}}),e=function(){var a=c.defer();return d.query().$promise.then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},f=function(a){var b=c.defer();return d.create({pixel:{name:a.name,advertiser_id:a.advertiser_id}}).$promise.then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},g=function(a){var b=c.defer();return d.update({id:a.id},{pixel:a}).$promise.then(function(a){console.log("update px success"),b.resolve(a)},function(a){b.reject(a),console.log("error updating px: "+a)}),b.promise},h=function(a){var b=c.defer();return d.remove({id:a.id}).$promise.then(function(){b.resolve()},function(){b.reject()}),b.promise},i=function(a){var b=c.defer();return d.get({id:a}).$promise.then(function(a){b.resolve(a.fires)},function(a){b.reject(a)}),b.promise},j=function(a){var b=c.defer();return d.get({id:a}).$promise.then(function(a){b.resolve(a.data)},function(a){b.reject(a)}),b.promise};return{getAll:e,create:f,update:g,remove:h,getFires:i,get:j}}])}(),function(){"use strict";angular.module("finalApp").constant("API_URI","http://localhost:3000/api/v1").service("Advertiser",["API_URI","$resource","$q",function(a,b,c){var d=b(a+"/advertisers/:id",{id:"@id"},{query:{method:"GET"},create:{url:a+"/advertisers/new",method:"POST"},update:{method:"PUT"},remove:{method:"DELETE"}}),e=function(){var a=c.defer();return d.query().$promise.then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},f=function(a){var b=c.defer();return d.create({advertiser:{name:a.name,address:a.address,city:a.city,post_code:a.post_code,tel:a.tel}}).$promise.then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},g=function(a){var b=c.defer();return d.update({id:a.id},{advertiser:{name:a.name,address:a.address,city:a.city,post_code:a.post_code,tel:a.tel}}).$promise.then(function(a){console.log("update success"),b.resolve(a)},function(a){b.reject(a)}),b.promise},h=function(a){var b=c.defer();return d.remove({id:a.id}).$promise.then(function(){b.resolve()},function(){b.reject()}),b.promise};return{getAll:e,create:f,update:g,remove:h}}])}(),angular.module("finalApp").directive("zippy",["$timeout",function(a){return{template:'<dt ng-mouseover="hoverIn()" ng-mouseleave="hoverOut()" ng-click="toggleContent()"><div class="row"> <div class="small-3 medium-4 columns left title">{{title}}</div><div class="small-3 medium-4 columns left badge"><span class="number" ng-show="badge">&nbsp{{badge}}</span></div><div class="small-3 medium-2 columns"></div><div class="small-3 medium-2 columns" ng-show="!showHover"></div><div class="small-3 medium-2 columns commands" ng-show="showHover"> <span ng-click="edit();noToggle();"> edit |</span><span ng-click="delete();noToggle();">| delete</span>  </div></div><dd ng-if="isContentVisible" ng-transclude></dd></dt>',restrict:"A",transclude:!0,scope:{title:"@",badge:"@","delete":"&",edit:"&"},link:function(b,c,d){b.isContentVisible=!1,b.noContent=!1,b.toggleContent=function(){a(function(){b.noContent||(b.isContentVisible=!b.isContentVisible),b.noContent=!1},100)},b.hoverIn=function(){b.showHover=!0},b.hoverOut=function(){b.showHover=!1},b.noToggle=function(){b.noContent=!0}}}}]),angular.module("finalApp").directive("pixelEscape",["$timeout",function(a){"use strict";var b=27;return function(a,c,d){c.bind("keydown",function(c){c.keyCode===b&&a.$apply(d.pixelEscape)}),a.$on("$destroy",function(){c.unbind("keydown")})}}]),angular.module("finalApp").directive("pixelFocus",["$timeout",function(a){"use strict";return function(b,c,d){b.$watch(d.pixelFocus,function(b){b&&a(function(){console.log("focusing..."),c[0].focus()},0,!1)})}}]),angular.module("finalApp").directive("pixely",["$timeout",function(a){"use strict";return{template:'<div class="pixel-box" ng-dblclick="edit();editingOn();" ng-mouseover="hoverIn()" ng-mouseleave="hoverOut()"><label class="view title">{{title}}<span ng-if="showHover" ng-click="delete()" class="right delete"> x </span><span ng-if="!showHover" class="right clear-delete"> x </span></label><form ng-submit="submit({name:title});editingOff();"><input class="edit" ng-model="title" pixel-escape="escape();editingOff();" pixel-focus="focus()" ></form><div ng-if="showHover" ng-transclude></div></div>',restrict:"A",transclude:!0,scope:{title:"@",edit:"&","delete":"&",submit:"&",escape:"&",focus:"&"},link:function(a,b,c){a.hoverIn=function(){a.showHover=!0},a.hoverOut=function(){a.showHover=!1}}}}]),angular.module("finalApp").directive("newpixely",["$timeout",function(a){"use strict";return{template:'<form ng-submit="submit({name:name});clearInput();"><input ng-cloak ng-show="showInput" ng-blur="hideInput()" pixel-focus="showInput" placeholder="pixel name" ng-model="name" pixel-escape="clearInput()"><p style="font-size: small;" ng-cloak ng-show="!showInput" ng-click="toggleInput()">add new pixel + </p></form>',restrict:"A",scope:{submit:"&"},link:function(a,b,c){a.showInput=!1,a.toggleInput=function(){a.showInput=!a.showInput},a.clearInput=function(){a.name="",a.toggleInput()},a.hideInput=function(){a.name="",a.showInput=!1}}}}]),angular.module("finalApp").controller("PixelsCtrl",["$state","fires","pixel",function(a,b,c){var d=this;d.fires=b,d.pixel=c,d.goBack=function(){a.go("main")}}]),angular.module("finalApp").controller("AsideCtrl",[$scope,function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);